<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SWASTHA â€” Nearby Hospitals</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    html,
    body {
      height: 100%;
      margin: 0;
      font-family: 'Poppins', Arial, sans-serif;
      background: linear-gradient(120deg, #ffd9f0 0%, #e7e8ff 100%);
      color: #181823;
      min-height: 100vh;
      width: 100vw;
      overflow-x: hidden;
    }

    .top-heading {
      width: 100vw;
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 60px;
      padding: 38px 0 8px 48px;
      position: relative;
    }

    .app-logo {
      width: 58px;
      height: 58px;
      border-radius: 14px;
      margin-right: 8px;
      box-shadow: 0 2px 13px rgba(110, 67, 214, .10);
    }

    .brand-group {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 14px;
      /* sets space between logo and text */
    }

    .brand-label {
      font-size: 34px;
      font-weight: 700;
      margin-right: 10px;
      color: #20202a;
      letter-spacing: 0.012em;
      margin-bottom: 0;
    }

    .heading-main {
      margin: 0;
      margin-top: 13px;
      font-family: 'Comic Sans MS', 'Segoe Script', cursive, sans-serif;
      font-size: 74px;
      font-weight: 900;
      color: #181423;
      letter-spacing: 0.01em;
      line-height: 0.98;
      text-align: left;
    }

    .navbar {
      margin-left: auto;
      margin-right: 70px;
      display: flex;
      align-items: center;
      margin-top: -70px;
    }

    .home-icon-link {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      border-radius: 8px;
      padding: 4px;
      transition: background 0.2s;
    }

    .home-icon-link:hover {
      background: #f3e9ff;
    }

    .main-content-row {
      width: 100vw;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      gap: 42px;
      margin-top: 22px;
      flex-wrap: wrap;
    }

    .left-block {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-width: 245px;
      margin-top: 27px;
    }

    .hospital-icon {
      width: 180px;
      height: 180px;
      border-radius: 28px;
      background: #e5e2fc;
      box-shadow: 0 6px 18px rgba(110, 67, 214, 0.10);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .hospital-icon img {
      width: 78%;
    }

    .card {
      background: #fff;
      border-radius: 22px;
      box-shadow: 0 12px 32px rgba(140, 120, 240, 0.11);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 44px 35px 36px 35px;
      gap: 24px;
      min-width: 320px;
      max-width: 390px;
      transition: box-shadow .17s;
    }

    .card:hover {
      box-shadow: 0 20px 50px rgba(140, 120, 240, 0.16);
    }

    .card label {
      font-weight: 700;
      font-size: 1.36rem;
      text-align: center;
      color: #232f4d;
    }

    .card input[type="text"] {
      width: 100%;
      border-radius: 14px;
      border: 2px solid #c2bbef;
      background: #efebf8;
      font-size: 1.20rem;
      color: #3d3354;
      padding: 15px 18px;
      margin-top: 14px;
      margin-bottom: 12px;
      box-shadow: 0 2px 11px rgba(120, 80, 190, 0.09);
      transition: border-color .18s, box-shadow .16s;
    }

    .card input[type="text"]:focus {
      border-color: #7e7eea;
      box-shadow: 0 6px 20px rgba(140, 120, 230, 0.13);
    }

    .manual-btn {
      width: 100%;
      background: linear-gradient(90deg, #896cfe 0%, #76e0fa 100%);
      box-shadow: 0 3px 20px rgba(100, 150, 220, 0.09);
      font-weight: 700;
      font-size: 1.27rem;
      border-radius: 17px;
      border: none;
      color: #fff;
      padding: 17px 0;
      cursor: pointer;
      margin: 12px 0 0 0;
      transition: box-shadow .13s, transform .15s, background .17s;
    }

    .manual-btn:hover {
      background: linear-gradient(90deg, #6fb0e8 0%, #896cfe 100%);
      transform: scale(1.055);
      box-shadow: 0 8px 38px rgba(140, 120, 240, 0.16);
    }

    .results-list {
      margin-top: 38px;
      background: #faf8fe;
      border-radius: 24px;
      box-shadow: 0 8px 40px rgba(120, 80, 190, 0.11);
      padding: 22px 30px 26px 32px;
      min-width: 325px;
      max-width: 420px;
      font-size: 1.18rem;
      color: #3e266b;
      text-align: left;
      font-weight: 600;
      display: none;
      transition: box-shadow .18s;
    }

    .results-list ul {
      list-style: disc inside;
      padding: 0;
      margin: 0;
    }

    .results-list li {
      background: rgba(220, 218, 255, 0.45);
      margin-top: 15px;
      margin-bottom: 15px;
      padding: 19px 26px 15px 23px;
      border-radius: 19px;
      font-size: 1.23rem;
      font-weight: 600;
      color: #33214a;
      box-shadow: 0 2px 11px rgba(120, 80, 190, 0.09);
      display: flex;
      align-items: center;
      gap: 16px;
      justify-content: space-between;
    }

    .results-list li:hover {
      background: rgba(180, 174, 241, 0.34);
    }

    .results-list span {
      color: #7a7a97;
      font-weight: 500;
      font-size: 1.03rem;
      margin-left: 9px;
    }

    .results-list button {
      margin-left: 20px;
      padding: 11px 20px;
      font-size: 1.12rem;
      background: linear-gradient(88deg, #8664fc 18%, #53c7fc 90%);
      color: #fff;
      border: none;
      border-radius: 20px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 2.5px 13px rgba(120, 140, 220, .11);
      transition: background .13s, transform .14s;
    }

    .results-list button:hover {
      background: linear-gradient(60deg, #75bcf7 18%, #8664fc 90%);
      transform: scale(1.11);
    }

    @media(max-width:1045px) {

      .top-heading,
      .main-content-row {
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 28px;
      }

      .heading-main {
        text-align: center;
      }
    }

    @media(max-width:650px) {
      .top-heading {
        flex-direction: column;
        align-items: center;
        padding: 20px 0 0 0;
      }

      .main-content-row {
        flex-direction: column;
        gap: 22px;
      }

      .results-list,
      .card {
        min-width: 95vw !important;
        max-width: 98vw !important;
      }

      .left-block,
      .brand-label {
        align-items: center;
        text-align: center;
      }
    }
  </style>
</head>

<body>
  <div class="top-heading">
    <div class="brand-group">
      <img class="app-logo" src="/static/icons/logo.jpg" alt="SWASTHA logo">
      <span class="brand-label">SWASTHA</span>
    </div>
    <h1 class="heading-main">Nearby Hospitals</h1>
    <nav class="navbar">
      <a href="{{ url_for('homepage') }}" class="home-icon-link" title="Home">
        <!-- SVG Home icon -->
        <svg width="50" height="50" viewBox="0 0 24 24" fill="none" style="vertical-align:middle">
          <path d="M3 11.6L12 4l9 7.6M5 10.7V20a1 1 0 001 1h12a1 1 0 001-1v-9.3" stroke="#5639c9" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </a>
    </nav>
  </div>

  <div class="main-content-row">
    <div class="left-block">
      <div class="hospital-icon">
        <img src="/static/icons/hospital-icon.jpg" alt="Hospital icon">
      </div>
    </div>
    <div class="card">
      <label for="location-input">Enter your location manually:</label>
      <input type="text" id="location-input" placeholder="Type your city or area name.">
      <button class="manual-btn" id="find-hospitals-btn" style="margin-top:10px;">Find Hospitals</button>
    </div>
  </div>
  <!-- Results -->
  <div style="width:100vw;display:flex;justify-content:center;">
    <div id="results" class="results-list"></div>
  </div>
  <script>
    // Geocoding with LocationIQ
    function geocodeLocation(locationString, callback) {
      fetch(`https://us1.locationiq.com/v1/search.php?key=pk.306d0c0825d385e6515cbbe7564cfe9f&q=${encodeURIComponent(locationString)}&format=json`)
        .then(resp => resp.json())
        .then(data => {
          if (Array.isArray(data) && data.length > 0) {
            const lat = parseFloat(data[0].lat);
            const lon = parseFloat(data[0].lon);
            callback(lat, lon);
          } else {
            alert('Location not found!');
          }
        })
        .catch(() => alert('Geocoding failed!'));
    }
    // Haversine formula to compute distance between two coordinates (returns km)
    function getDistanceKm(lat1, lon1, lat2, lon2) {
      const R = 6371;
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
        Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
        Math.sin(dLon / 2) * Math.sin(dLon / 2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return R * c;
    }
    function getHospitals(lat, lon, radius = 2000) {
      fetch('/search_hospitals', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ lat: lat, lon: lon, radius: radius })
      })
        .then(response => response.json())
        .then(data => {
          let resultsDiv = document.getElementById('results');
          resultsDiv.style.display = "block";
          resultsDiv.innerHTML = '';
          if (!data.length || data.error) {
            resultsDiv.textContent = 'No hospitals found.';
            return;
          }
          const ul = document.createElement('ul');
          const maxDistKm = radius / 1000;
          data
            .map(hospital => {
              const dist = getDistanceKm(lat, lon, parseFloat(hospital.latitude), parseFloat(hospital.longitude));
              hospital.distance = dist;
              return hospital;
            })
            .filter(hospital => hospital.distance <= maxDistKm)
            .sort((a, b) => a.distance - b.distance)
            .forEach(hospital => {
              const li = document.createElement('li');
              li.innerHTML = `
              ${hospital.name} (${hospital.latitude}, ${hospital.longitude}) 
              <span style="font-size:0.98em;color:#888;"> - ${hospital.distance.toFixed(2)} km</span>
              <button onclick="window.open('https://www.google.com/maps/search/?api=1&query=${hospital.latitude},${hospital.longitude}','_blank')"
                style="margin-left:12px;padding:5px 14px;border-radius:10px;border:none;background:#7b68ee;color:#fff;cursor:pointer;font-weight:600;">Directions</button>
            `;
              ul.appendChild(li);
            });
          resultsDiv.appendChild(ul);
        });
    }
    // Demo coords for JP Nagar
    const demoLat = 12.912647, demoLon = 77.588913, defaultRadius = 1000;
    document.getElementById('find-hospitals-btn').onclick = function () {
      const entered = document.getElementById('location-input').value.trim();
      if (entered.length) {
        geocodeLocation(entered, function (lat, lon) {
          getHospitals(lat, lon, defaultRadius);
        });
      } else {
        // Use demo coordinates if field is empty
        getHospitals(demoLat, demoLon, defaultRadius);
      }
    };
  </script>
</body>

</html>